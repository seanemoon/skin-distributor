{% extends "layout.html" %}
{% block body %}
  <div class=section>Create Template</div>
  <div class=container>
    {% from "_formhelpers.html" import render_field %}

    {% if update %}
      <form method=post action="{{ url_for('edit_template', event_id=event_id) }}">
    {% else %}
      <form method=post action="{{ url_for('create_template', event_id=event_id) }}">
    {% endif %}
      {{ render_field(form.sender, placeholder="Sender") }}
      {{ render_field(form.subject, placeholder="Subject") }}
      {{ render_field(form.header, placeholder="Header") }}
      {{ render_field(form.body, placeholder="Body") }}
      {{ render_field(form.code_types) }}

      <div class="codes">
        Code Types
        <div id="code-types">
        {% for type in code_types %}
        <div>{{type}}</div>
        {% endfor %}
        </div>
        <input id=code-type-input type=text autocomplete="off" placeholder="Riot Kayle">
        <input id=add-code-type type=button value='Add code type'>
      </div>
      <input type=submit value='Create Template'>
    </form>
  </div>

  <script type=text/javascript>
  $(document).ready(function() {
    $(function() {
      var code_types = new Array();
      {% for code in code_types %}
      code_types[code_types.length] = "{{code|safe}}"
      {% endfor %}
      $('form input[type="hidden"]').val(JSON.stringify(code_types))

      // Handler for adding a new code type
      $('#add-code-type').click(function() {
        var type = $('#code-type-input').val()
        if (type.length > 0) {
          $('#code-types').append($('<div>' + type + '</div>'));
          code_types[code_types.length] = type;
          console.log(code_types);
          $('form input[type="hidden"]').val(JSON.stringify(code_types))
          $('#code-type-input').val('');
        }
      });

      // Make enter add a code when entering a code type
      $('#code-type-input').keypress(function(event) {
        if (event.which == 13) {
          event.preventDefault();
          $('#add-code-type').trigger('click');
        }
      });
    });
  });
  </script>
{% endblock %}
